---
title: "Rating Scale Analysis"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

### Norms (raw-to-T) lookup tables

This code template derives normalized T-scores from an input data file with multiple raw scores, including subscales and composite scores. Because normalizing models may differ depending on the raw score distributions, the code is designed to handle only a single input file (e.g., a single combination of age-range and rater). The template is meant to be implemented separately for each input file.

The output includes raw-to-T lookup tables in both generalized and print formats, as well as raw score descriptives and demographic counts. 

#### 1. Load packages, read data, initialize strings for robust code

###### EXECUTABLE CODE
```{r norms-load, eval = FALSE}
suppressMessages(library(here))
suppressMessages(suppressWarnings(library(tidyverse)))
suppressMessages(library(psych))
suppressMessages(library(bestNormalize))

urlRemote_path  <- "https://raw.githubusercontent.com/"
github_path <- "DSHerzberg/RATING-SCALE-ANALYSIS/master/INPUT-FILES/"
input_name <- "data-RS-sim-child-parent.csv"

item_prefix <- "cp"
scale_prefix <- "CP"
scale_suffix <- c("S1", "S2", "S3", "S4", "S5", "TOT")
age_range_name <- "child"
form_name <- "parent"
all_raw_range <- 10:200
TOT_raw_lower_bound <- 50
subscale_raw_upper_bound <- 40

assign(
  str_c("data", age_range_name, form_name, sep = "_"),
  suppressMessages(read_csv(url(
    str_c(urlRemote_path, github_path, input_name)
  ))) %>%
    mutate(across(
      contains(str_c(item_prefix, "i")),
      ~ case_when(
        .x == "never" ~ 1,
        .x == "occasionally" ~ 2,
        .x == "frequently" ~ 3,
        .x == "always" ~ 4
      )
    ))
)

 assign(str_c("data", age_range_name, form_name, "TOT", sep = "_"),
       suppressMessages(read_csv(url(
         str_c(urlRemote_path, github_path, input_name)
       ))) %>% 
         select(!!sym(str_c(scale_prefix, "TOT_raw"))) %>% 
         as_vector() %>% 
         set_names(NULL)
)
```

###### COMMENTED SNIPPETS
Load packages for file path specification (`here`), data wrangling (`tidyverse`),  psychometric data simulation and analysis (`psych`), and normalization of raw score distributions (`bestNormalize`).
```{r norms-load, echo = 1:4, eval = F}
```
We write _robust_ code that can be adapted to different projects with a minimum of copying-and-pasting tex. We facilitate this by providing object name placeholders for file paths, file and variable names (and their component sub-strings), score ranges, and other snippets of code that are re-used throughout the template.
```{r norms-load, echo = 5:16, eval = F}
```
In a robust template, we create object names by concatenating input name placeholders and sub-strings. Instead of the assignment operator `<--`, we use `base::assign()` to initialize these concatenated names. `assign()` takes two arguments, the desired name (concatenate with `stringr::str_c()`), and the code snippet that defines the object to be named.

As an example, `str_c("data", age_range_name, form_name, sep = "_")` returns the name `data_child_parent`, combining the file type description (`"data"`) with the age-range (`"child"`) and rater (`"parent"`) combination that identifies the form whose data is contained in the input file
```{r norms-load, echo = 19:20, eval = F}
```
The next snippet uses `mutate(across()` to recode the item responses into numerical values.
```{r norms-load, echo = 24:31, eval = F}
```

<br>

